version: "3"
services:
  home-assistant:
    container_name: home-assistant
    build: ./home-assistant
    restart: always
    ports:
      - "0.0.0.0:8123:8123"
    links:
      - mosquitto:mqtt
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./home-assistant/config:/config

  mosquitto:
    container_name: mosquitto
    build: ./mosquitto
    restart: always
    ports:
      - "0.0.0.0:1883:1883"
    volumes:
      - ./mosquitto/config:/mosquitto/config/

  snips-master:
    container_name: snips-master
    build: ./snips-master
    restart: always
    privileged: true
    devices:
      - "/dev/snd"
    links:
      - mosquitto:mqtt
    depends_on:
      - mosquitto
    volumes:
      - ./snips-master/config/:/config
      - /var/run/dbus:/var/run/dbus
      - /etc/machine-id:/etc/machine-id

  snips-satellite:
    container_name: snips-satellite
    build: ./snips-satellite
    devices:
      - "/dev/snd"
    links:
      - mosquitto:mqtt
    depends_on:
      - mosquitto
      - snips-master
    volumes:
      - ./snips-master/config/:/config
      - /var/run/dbus:/var/run/dbus
      - /etc/machine-id:/etc/machine-id

  snips-watch:
    container_name: snips-watch
    build: ./snips-watch
    restart: always
    privileged: true
    links:
      - mosquitto:mqtt
    volumes:
      - ./snips-master/config/:/config

  mqtt-deamon:
    container_name: mqtt-deamon
    build: ./mqtt-deamon
    links:
      - mosquitto:mqtt
    volumes:
      - ./mqtt-deamon/files:/files
      - ./mqtt-deamon/config:/config
