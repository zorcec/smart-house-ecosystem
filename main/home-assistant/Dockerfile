FROM python:3.6

ENV INSTALLATION_PATH /usr/src/app

# Uncomment any of the following lines to disable the installation.
#ENV INSTALL_TELLSTICK no
#ENV INSTALL_OPENALPR no
#ENV INSTALL_FFMPEG no
#ENV INSTALL_LIBCEC no
#ENV INSTALL_SSOCR no
#ENV INSTALL_IPERF3 no

VOLUME /config

RUN mkdir -p /temp
RUN apt-get update && apt-get install git
RUN git clone https://github.com/home-assistant/home-assistant.git $INSTALLATION_PATH && \
    cd $INSTALLATION_PATH && \
    git checkout tags/0.80.0
    
WORKDIR $INSTALLATION_PATH

# Build & setup
RUN virtualization/Docker/setup_docker_prereqs

# Install hass component dependencies
RUN pip3 install --no-cache-dir -r requirements_all.txt && \
    pip3 install --no-cache-dir mysqlclient psycopg2 uvloop cchardet cython

CMD [ "python", "-m", "homeassistant", "--config", "/config" ]